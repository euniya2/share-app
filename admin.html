<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ (Admin)</title>
    <!-- Tailwind CSS (ê°„í¸í•œ ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">

    <!-- ğŸ” ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ (ì´ˆê¸° ì‹¤í–‰ ì‹œ ë³´ì„) -->
    <div id="login-wrapper" class="fixed inset-0 z-50 bg-gray-900 flex items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700 text-center max-w-sm w-full mx-4">
            <h2 class="text-2xl font-bold text-white mb-2">ê´€ë¦¬ì ì ‘ê·¼</h2>
            <p class="text-gray-400 text-sm mb-6">í•™ìƒ ì‘í’ˆ ê´€ë¦¬ í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
            
            <input type="password" id="admin-pw" 
                class="w-full bg-gray-700 border border-gray-600 rounded px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-blue-500 mb-4 text-center tracking-widest"
                placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                onkeypress="if(event.key === 'Enter') checkPassword()">
            
            <button onclick="checkPassword()" 
                class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded transition shadow-lg">
                í™•ì¸
            </button>
            <p id="login-msg" class="text-red-400 text-sm mt-3 h-5"></p>
        </div>
    </div>

    <!-- ğŸš€ ë©”ì¸ ê´€ë¦¬ì í™”ë©´ (ë¡œê·¸ì¸ í›„ ë³´ì„) -->
    <div id="app-wrapper" style="display: none;" class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="flex justify-between items-center mb-8 border-b border-gray-700 pb-4">
            <h1 class="text-3xl font-bold text-white">ğŸ“‘ í•™ìƒ ì‘í’ˆ ëª©ë¡</h1>
            <button onclick="loadList()" class="text-sm bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded transition">
                ìƒˆë¡œê³ ì¹¨
            </button>
        </header>

        <ul id="list" class="space-y-4">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            <li class="text-gray-500 text-center py-8">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
        </ul>
    </div>

    <!-- Firebase ë° ë¡œì§ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, deleteDoc, doc, orderBy, query } 
            from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyCn907zY1vFfAMNPxyflCOEeJSyd0yKnhs",
            authDomain: "web-class-console.firebaseapp.com",
            projectId: "web-class-console",
            storageBucket: "web-class-console.firebasestorage.app",
            messagingSenderId: "771726293778",
            appId: "1:771726293778:web:e126c7c62ee339f5dfd1cb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ğŸ“‹ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ (ì „ì—­ window ê°ì²´ì— ë“±ë¡í•˜ì—¬ HTMLì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡ í•¨)
        window.loadList = async function() {
            const listEl = document.getElementById('list');
            listEl.innerHTML = '<li class="text-gray-500 text-center py-8">ëª©ë¡ì„ ê°±ì‹  ì¤‘ì…ë‹ˆë‹¤...</li>';

            try {
                // ìµœì‹ ìˆœ(createdAt ë‚´ë¦¼ì°¨ìˆœ) ì •ë ¬
                const q = query(collection(db, "pages"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);

                listEl.innerHTML = ""; // ì´ˆê¸°í™”

                if (querySnapshot.empty) {
                    listEl.innerHTML = '<li class="text-gray-500 text-center py-8">ë“±ë¡ëœ í˜ì´ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                    return;
                }

                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString() : 'ë‚ ì§œ ì—†ìŒ';
                    
                    const li = document.createElement('li');
                    li.className = "bg-gray-800 rounded-lg p-5 border border-gray-700 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 hover:border-gray-600 transition";
                    
                    li.innerHTML = `
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="bg-blue-900 text-blue-200 text-xs px-2 py-0.5 rounded font-mono">ID: ${docSnap.id.slice(0, 8)}...</span>
                                <span class="text-gray-400 text-xs">${date}</span>
                            </div>
                            <a href="index.html?id=${docSnap.id}" target="_blank" class="text-blue-400 font-semibold hover:underline text-lg flex items-center gap-1">
                                ğŸ”— ë°”ë¡œê°€ê¸° (Click)
                            </a>
                        </div>
                        <button onclick="deleteItem('${docSnap.id}')" 
                            class="bg-red-900/50 hover:bg-red-600 text-red-200 hover:text-white px-4 py-2 rounded border border-red-800/50 transition text-sm">
                            ì‚­ì œí•˜ê¸°
                        </button>
                    `;
                    listEl.appendChild(li);
                });
            } catch (e) {
                console.error("Error:", e);
                listEl.innerHTML = `<li class="text-red-400 text-center">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${e.message}</li>`;
            }
        };

        // ğŸ—‘ï¸ ì‚­ì œ í•¨ìˆ˜
        window.deleteItem = async (id) => {
            if(confirm("ì •ë§ ì´ í•™ìƒì˜ ì‘í’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)")) {
                try {
                    await deleteDoc(doc(db, "pages", id));
                    alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    window.loadList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } catch (e) {
                    alert("ì‚­ì œ ì‹¤íŒ¨: " + e.message);
                }
            }
        };

        // ğŸ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•¨ìˆ˜
        window.checkPassword = function() {
            const pwInput = document.getElementById('admin-pw');
            const msg = document.getElementById('login-msg');
            
            if (pwInput.value === '091015') {
                // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
                document.getElementById('login-wrapper').style.display = 'none';
                document.getElementById('app-wrapper').style.display = 'block';
                // ë¡œê·¸ì¸ ì„±ê³µ ì‹œì—ë§Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤ (DB ì½ê¸° ì ˆì•½)
                window.loadList();
            } else {
                msg.innerText = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                pwInput.value = '';
                pwInput.focus();
            }
        };
    </script>
</body>
</html>
